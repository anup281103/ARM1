<div class="container-fluid p-0">

  <!-- HEADER -->
  <div class="bg-primary text-white p-4 rounded-bottom">
    <small class="text-uppercase opacity-75" *ngIf="purchaseOrder">{{ purchaseOrder.supplier || 'Dealer' }}</small>
    <h3 class="fw-bold mb-1 text-white">
      Purchase Order {{ purchaseOrder?.name || purchaseOrderId }}
    </h3>

    <div class="d-flex align-items-center gap-2 mt-2">
      <span *ngIf="purchaseOrder">Status: <i class="feather icon-check-circle"></i> {{ purchaseOrder.status }}</span>
    </div>
  </div>

  <!-- PROCUREMENT JOURNEY -->
  <div class="mt-4">

   <div class="card  p-4">

  <div class="text-uppercase fw-semibold text-muted mb-3">
    Procurement Journey
  </div>

  <div class="journey-wrapper">

    <!-- Material Request -->
    <div class="journey-step" [ngClass]="getMaterialRequestStatus().cssClass">
      <i class="feather icon-file-text"></i>
      <div>
        <div class="title">Material Request</div>
        <div class="status">{{ getMaterialRequestStatus().status }}</div>
      </div>
    </div>

    <div class="arrow">
      <i class="feather icon-arrow-right"></i>
    </div>

    <!-- Purchase Order -->
    <div class="journey-step" [ngClass]="getPurchaseOrderStatus().cssClass">
      <i class="feather icon-check-square"></i>
      <div>
        <div class="title">Purchase Order</div>
        <div class="status">{{ getPurchaseOrderStatus().status }}</div>
      </div>
    </div>

    <div class="arrow">
      <i class="feather icon-arrow-right"></i>
    </div>

    <!-- Purchase Receipt -->
    <div class="journey-step" [ngClass]="getPurchaseReceiptStatus().cssClass">
      <i class="feather icon-package"></i>
      <div>
        <div class="title">Purchase Receipt</div>
        <div class="status">{{ getPurchaseReceiptStatus().status }}</div>
      </div>
    </div>

    <div class="arrow">
      <i class="feather icon-arrow-right"></i>
    </div>

    <!-- Purchase Invoice -->
    <div class="journey-step" [ngClass]="getPurchaseInvoiceStatus().cssClass">
      <i class="feather icon-file"></i>
      <div>
        <div class="title">Purchase Invoice</div>
        <div class="status">{{ getPurchaseInvoiceStatus().status }}</div>
      </div>
    </div>

    <div class="arrow">
      <i class="feather icon-arrow-right"></i>
    </div>

    <!-- Payment -->
    <div class="journey-step" [ngClass]="getPaymentStatus().cssClass">
      <i class="feather icon-credit-card"></i>
      <div>
        <div class="title">Payment</div>
        <div class="status">{{ getPaymentStatus().status }}</div>
      </div>
    </div>

  </div>

  <!-- progress line -->
  <div class="progress-line mt-3">
    <span class="progress-active" [style.width.%]="getJourneyProgress()"></span>
  </div>

</div>


    <!-- LOADING STATE -->
    <div class="card mb-4" *ngIf="loading">
      <div class="card-body text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading purchase order details...</p>
      </div>
    </div>

    <!-- ERROR STATE -->
    <div class="card mb-4" *ngIf="error && !loading">
      <div class="card-body text-center py-5">
        <div class="text-danger">
          <i class="feather icon-alert-circle" style="font-size: 3rem;"></i>
          <p class="mt-3">{{ error }}</p>
        </div>
      </div>
    </div>

    <!-- DETAILS -->
    <div class="card mb-4" *ngIf="purchaseOrder && !loading && !error">
      <div class="card-body">

        <div class="row g-3">

          <div class="col-md-4">
            <label class="form-label">PO Number</label>
            <input class="form-control" [value]="purchaseOrder.name || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Workflow State</label>
            <input class="form-control" [value]="purchaseOrder.workflow_state || purchaseOrder.status || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Grand Total</label>
            <input class="form-control" [value]="purchaseOrder.grand_total || 0" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Company</label>
            <input class="form-control" [value]="purchaseOrder.company || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Supplier</label>
            <input class="form-control" [value]="purchaseOrder.supplier || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Buying Price List</label>
            <input class="form-control" [value]="purchaseOrder.buying_price_list || 'Standard Buying'" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Transaction Date</label>
            <input class="form-control" [value]="purchaseOrder.transaction_date || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Schedule Date</label>
            <input class="form-control" [value]="purchaseOrder.schedule_date || ''" readonly>
          </div>

          <div class="col-md-4">
            <label class="form-label">Remarks</label>
            <input class="form-control" [value]="purchaseOrder.remarks || ''" [placeholder]="!purchaseOrder.remarks ? 'â€”' : ''" readonly>
          </div>

        </div>

      </div>
    </div>

    <!-- ITEMS -->
    <div class="card" *ngIf="purchaseOrder && !loading && !error">
      <div class="card-body">

        <h6 class="text-uppercase text-muted mb-3">
          Items
        </h6>

        <div class="table-responsive">
          <table class="table table-bordered align-middle text-center">
            <thead class="table-light">
              <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Rate</th>
                <th>UOM</th>
                <th>Required By</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngIf="!purchaseOrder.items || purchaseOrder.items.length === 0">
                <td colspan="5" class="text-muted">No items found</td>
              </tr>
              <tr *ngFor="let item of purchaseOrder.items">
                <td class="text-start">
                  {{ item.item_name || item.item_code }}
                  <div class="small text-muted" *ngIf="item.warehouse">
                    {{ item.warehouse }}
                  </div>
                </td>
                <td>{{ item.qty || 0 }}</td>
                <td>{{ item.rate || 0 }}</td>
                <td>{{ item.uom || item.stock_uom || 'Nos' }}</td>
                <td>{{ item.schedule_date || '' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>

  </div>
</div>
